# CLIC概览

在这一节当中会给出CLIC接收中断信号并给出处理器所需要处理的下一个中断的总览流程。

CLIC支持每个hart多达4096个中断信号的输入。每个中断输入*i*包含4个8位的内存映射的控制寄存器：一个中断等待位（interrupt-pending bit）`clicintip[i]`，一个中断使能位（interrupt-enable bit）`clicintie[i]`，中断属性（interrupt attributes）`clicintattr[i]`来指定特权模式以及触发类型，以及中断控制位（interrupt control bits）来指定中断的级别一级优先级`clicintctl[i]`。

前16个中断输入保留给原本基础的中断模式（也就是`xip`以及`xie`寄存器的低16位），因此最多可以添加4080个本地/外部中断。

## 中断抢占

CLIC扩展了中断抢占的机制使其对每个特权模式支持多达256个中断级别，其中中断级别数字越大的中断可以抢占数字小的中断（也就是说中断级别数字越大，中断级别越高）。中断级别0表示所有非中断服务程序的正常执行的程序。而中断服务程序对应着1到255级的中断级别。平台的配置文件会决定必须要支持多少个中断级别。

在同一个特权模式下，一个到来的高中断等级的中断可以抢占正在执行的低中断等级的中断服务程序，且在当前特权模式下中断是全局使能有效的。

> 现有的RISC-V中断行为同样会保留下来，也就是：一个更高的特权模式下到来的中断可以抢张当前运行在更低的特权模式下的中断服务程序，无论当前更低特权模式下的全局中断使能使否有效。

## CLIC与其他的本地中断的交互

CLI包含提供于`xip`/`xie`中的低16位的基本本地中断功能，因此这些基本的本地中断将不会在`xip`/`xie`中可见。

现有的计时中断（`mtip`/`stip`/`utip`），软件中断（`msip`/`ssip`/`usip`），以及外部中断（`meip`/`seip`/`ueip`）将会被视作额外的本地中断源，而特权模式、中断等级以及优先级可以使用内存映射的`clicintattr[i]`以及`clicintctl[i]`寄存器来进行修改。

> 在CLIC模式中，这些信号的中断委托（interrupt delegation）将会通过改变CLIC中断属性寄存器（`clicintattr`）的中断特权模式来实现，任何的CLIC中断输入都使用上述的方式来达成。